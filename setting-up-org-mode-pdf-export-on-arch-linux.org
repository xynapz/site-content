#+TITLE: Setting Up Org Mode PDF Export on Arch Linux: A Debugging Journey
#+AUTHOR: Angel Dhakal
#+DATE: 2025-11-26
#+DESCRIPTION: A detailed walkthrough of configuring Emacs Org mode for LaTeX and PDF export on Arch Linux, including all the debugging steps, package installations, and configuration changes needed to make it work.
#+KEYWORDS: arch, linux, emacs, org-mode, latex, pdf, systems
#+OPTIONS: ^:{} num:nil toc:5 html-postamble:nil
#+HTML_HEAD: <meta name="pub_date" content="2025-11-26" />
#+HTML_HEAD: <meta name="updated_date" content="2025-11-26" />
#+EXPORT_FILE_NAME: /home/angel/xynapz/angeld.me/src/content/writings/setting-up-org-mode-pdf-export-on-arch-linux.html


* The Problem

I've been using Emacs and Org mode for a while now, mainly exporting to HTML for my Astro based website. My setup is a bit particular, I have conditional export settings that strip default CSS and scripts when exporting from my =site-content= directory, but keep them for personal notes. This has been working great.

Tonight, I decided it was time to add PDF export capabilities. I figured it would be straightforward: install some LaTeX packages, maybe tweak a few settings, and call it done. I was wrong.

When I tried to export an Org file to PDF, I was greeted with this error:

#+BEGIN_EXAMPLE
! LaTeX Error: File `ulem.sty' not found.

Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)

Enter file name:
! Emergency stop.
<read *>

l.11 \usepackage
                {amsmath}^^M
!  ==> Fatal error occurred, no output PDF file produced!
#+END_EXAMPLE

Great. Missing package. How hard could it be to fix?

* First Attempt: Finding the Missing Package

The error message was clear, LaTeX couldn't find =ulem.sty=. On Arch, I found out that most LaTeX packages come through the TeX Live distribution, so I started there.

My first instinct was to check what I already had installed:

#+BEGIN_SRC bash
pacman -Qi texlive-core 2>/dev/null || echo "not installed"
#+END_SRC

Turns out =texlive-core= is now =texlive-basic= in the 2025 release. Good to know. I had =texlive-basic= and =texlive-latexextra= already installed, so I thought I was covered.

But =ulem.sty= was still missing. I needed to find which package actually contains it.

** The Search

I tried the obvious approach first:

#+BEGIN_SRC bash
pacman -Ql texlive-latexextra | grep ulem.sty
#+END_SRC

Nothing. That's when I realized I needed to do some web searching. After looking through the Arch package database and some TeX forums, I found that =ulem.sty= is actually part of =texlive-plaingeneric=, not =latexextra=.

This makes sense, =ulem= provides underlining for plain TeX and generic formats, not just LaTeX. But it's not immediately obvious when you're in the middle of debugging.

** Installing the Right Package

#+BEGIN_SRC bash
sudo pacman -S texlive-plaingeneric
#+END_SRC

I verified the package was now findable:

#+BEGIN_SRC bash
kpsewhich ulem.sty
#+END_SRC

Output:
#+BEGIN_EXAMPLE
/usr/share/texmf-dist/tex/generic/ulem/ulem.sty
#+END_EXAMPLE

Perfect! Now to test the export again.

* Second Problem: The Wrong LaTeX Compiler

With =ulem.sty= installed, I tried exporting again. The error changed:

#+BEGIN_EXAMPLE
! Fatal Package fontspec Error: The fontspec package requires either XeTeX or
(fontspec)                      LuaTeX.
(fontspec)
(fontspec)                      You must change your typesetting engine to,
(fontspec)                      e.g., "xelatex" or "lualatex" instead of
(fontspec)                      "latex" or "pdflatex".
#+END_EXAMPLE

This was an important realization. My Org files were being exported using pdfLaTeX (the traditional LaTeX compiler), but my documents use the =fontspec= package for modern font support. The =fontspec= package is designed for Unicode engines and specifically requires either XeLaTeX or LuaLaTeX.

Here's the relevant part of my generated =.tex= file:

#+BEGIN_SRC latex
\usepackage{fontspec}
#+END_SRC

The =fontspec= package is fantastic for modern LaTeX documents, essentially it lets you use system fonts directly and handles Unicode properly. But it fundamentally doesn't work with pdfLaTeX.

** Why This Matters

Traditional pdfLaTeX uses a different font system based on legacy TeX font metrics. XeLaTeX and LuaLaTeX, on the other hand, are built from the ground up to handle Unicode and modern font formats (TrueType, OpenType). When you use =fontspec=, you're opting into this modern world.

I checked my Emacs configuration to see what I had set up:

#+BEGIN_SRC elisp
(setq org-latex-pdf-process
      '("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
        "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
        "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
#+END_SRC

There it was, I was explicitly telling Org mode to use pdfLaTeX. I needed to switch to XeLaTeX.

* Installing XeLaTeX

First, I needed to make sure I had the XeTeX package installed:

#+BEGIN_SRC bash
pacman -Qi texlive-xetex 2>/dev/null || echo "not installed"
#+END_SRC

It wasn't. So I installed it:

#+BEGIN_SRC bash
sudo pacman -S texlive-xetex
#+END_SRC

The post-install hooks automatically updates the TeX Live filename database and creates the necessary format files. This is one of the quality of life things about the Arch TeX Live packages, they handle the infrastructure setup for you.

* Updating the Emacs Configuration

Now came the interesting part: updating my Emacs config to use XeLaTeX without breaking my existing HTML export setup.

My Org mode configuration lives in =~/.emacs.d/lisp/xz-package.el=. The relevant section handles both HTML and LaTeX exports, and I needed to be careful not to break the HTML side of things.

Here's the context: I have a custom setup where Org files in my =~/xynapz/angeld.me/site-content/= directory export to HTML without default styles or scripts (because my Astro site provides those), while personal Org files keep the default formatting. This conditional behavior is handled by checking the file path during export.

** The LaTeX Configuration Changes
I needed to update the =ox-latex= configuration block. Here's what I changed:
#+BEGIN_SRC elisp
(use-package ox-latex
  :ensure nil
  :after org
  :config
  ;; new xelatex for PDF export (necessary for fontspec package)
  (setq org-latex-pdf-process
        '("xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"
          "xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"
          "xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"))

  ;; Set XeLaTeX as the default compiler
  (setq org-latex-compiler "xelatex")

  ;; Remove temporary files after export
  (setq org-latex-remove-logfiles nil)

  ;; Default LaTeX packages for better PDF output with XeLaTeX
  (setq org-latex-packages-alist
        '(("margin=1in" "geometry" nil)
          ("" "fontspec" t)      ; Modern font support (requires XeLaTeX/LuaLaTeX)
          ("" "xunicode" t)      ; Unicode support for XeLaTeX
          ("" "ulem" nil)        ; Underlining package
          ("" "listings" nil)    ; Code listings
          ("" "color" nil)))     ; Color support

  ;; Enable code highlighting in exported PDFs
  (setq org-latex-listings t)

  ;; Better default document class
  (setq org-latex-default-class "article")

  ;; Customize LaTeX classes if needed
  (add-to-list 'org-latex-classes
               '("article"
                 "\\documentclass[11pt]{article}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))))
#+END_SRC

** Key Changes Explained

1. *Changed the compiler command*: Replaced all instances of =pdflatex= with =xelatex=
2. *Set the compiler explicitly*: Added =(setq org-latex-compiler "xelatex")= to ensure Org mode knows which engine to use
3. *Added the =ulem= package*: Included it in =org-latex-packages-alist= so it's always available
4. *Kept =fontspec= and =xunicode=*: These were already there, and they're exactly what we need for XeLaTeX

The triple compilation (running XeLaTeX three times) is standard practice for LaTeX documents. The first pass generates the content, the second pass resolves references, and the third pass finalizes the table of contents and any cross-references. Yes, it's slower than a single pass, but it ensures everything is properly linked.

I left =org-latex-remove-logfiles= set to =nil= because I find the log files useful for debugging. If compilation fails, I can check the =.log= file to see exactly what went wrong.

* Testing the Configuration

I created a simple test file to verify everything worked:

#+BEGIN_SRC org
,#+TITLE: Emacs PDF Export Test
,#+AUTHOR: Test
,#+DATE: \today

,* Introduction
This is a test document to verify Org-mode PDF export works correctly.

,** Text Formatting
- *Bold text*
- /Italic text/
- _Underlined text_ (requires ulem package)
- +Strike-through text+

,* Code Example
Here's a simple Python function:

,#+BEGIN_SRC python
def greet(name):
    """Greet someone by name."""
    return f"Hello, {name}!"

print(greet("World"))
,#+END_SRC

,* Math Support
Inline equation: $E = mc^2$

Display equation:
\[ \int_a^b f(x) \, dx = F(b) - F(a) \]
#+END_SRC

I tested it both interactively in Emacs (=C-c C-e l p=) and via the command line:

#+BEGIN_SRC bash
emacs --batch \
      --eval "(progn (load-file \"init.el\")
                     (find-file \"test-export.org\")
                     (org-latex-export-to-pdf))"
#+END_SRC

Output:
#+BEGIN_EXAMPLE
Processing LaTeX file test-export.tex...
PDF file produced.
#+END_EXAMPLE

Success! The PDF was created without errors.

#+BEGIN_SRC bash
ls -lh test-export.pdf
#+END_SRC

#+BEGIN_EXAMPLE
-rw-r--r-- 1 angel angel 33K Nov 26 01:29 test-export.pdf
#+END_EXAMPLE

* What I Learned
** The Arch TeX Live Package Structure
Arch Linux splits TeX Live into several metapackages:
- =texlive-basic=: Core TeX programs and essential files
- =texlive-latex=: LaTeX-specific packages
- =texlive-latexextra=: Additional LaTeX packages
- =texlive-plaingeneric=: Plain TeX and generic format packages (this is where =ulem= lives)
- =texlive-xetex=: XeTeX engine for Unicode and modern fonts
- Many others for specialized needs (=texlive-science=, =texlive-publishers=, etc.)

The naming and organization changed with the 2025 release (=texlive-core= became =texlive-basic=), which can be confusing if you're following older documentation.

** XeLaTeX vs pdfLaTeX: When to Use What

*pdfLaTeX* is the traditional choice. Use it when:
- You're working with legacy documents
- You need specific pdfLaTeX-only packages
- You want the fastest compilation times
- You're only using Computer Modern or Type 1 fonts

*XeLaTeX* (or LuaLaTeX) is better for:
- Unicode text (non-English languages, mathematical symbols)
- System fonts (TrueType, OpenType)
- The =fontspec= package
- Modern LaTeX documents

For my use case, XeLaTeX is the right choice.

** The kpsewhich Tool

I discovered the =kpsewhich= utility during this process. It's incredibly useful for debugging TeX installations:

#+BEGIN_SRC bash
kpsewhich ulem.sty
#+END_SRC

This tells you exactly where TeX is finding (or not finding) a particular file.

* The Complete Package List
For anyone wanting to replicate this setup, here are all the Arch Linux packages I have installed for LaTeX support:

#+BEGIN_SRC bash
# Core TeX system
sudo pacman -S texlive-basic

# LaTeX support
sudo pacman -S texlive-latex

# Extended LaTeX packages
sudo pacman -S texlive-latexextra

# Plain TeX and generic formats (includes ulem)
sudo pacman -S texlive-plaingeneric

# XeTeX for modern fonts and Unicode
sudo pacman -S texlive-xetex
#+END_SRC

Total installed size is approximately 150 MiB. This is not tiny, but reasonable for a complete LaTeX setup.

* Debugging Tips
If you run into issues with LaTeX exports from Org mode, here's my debugging approach:

1. *Check the =*Messages*= buffer* in Emacs (=C-h e=): Org mode logs compilation output here
2. *Look for the =*Org PDF LaTeX Output*= buffer*: This contains the full LaTeX compiler output
3. *Examine the generated =.tex= file*: Sometimes the issue is in how Org mode generates the LaTeX, not in the compilation
4. *Use =kpsewhich= to verify packages*: Before assuming a package is installed, verify it:
   #+BEGIN_SRC bash
   kpsewhich ulem.sty
   #+END_SRC
5. *Test with manual compilation*: Try running =xelatex= directly on the =.tex= file to isolate whether it's an Emacs issue or a LaTeX issue
6. *Check package documentation*: The TeX Live documentation is extensive. For any package, you can usually find the manual.
* Final Thoughts
Setting this up taught me more about the LaTeX ecosystem than I expected. The error messages were actually quite helpful once I understood what they were saying "package not found" led me to =texlive-plaingeneric=, and "wrong compiler" led me to XeLaTeX.

The main gotcha was that my initial configuration was trying to use pdfLaTeX with packages that require XeLaTeX. This is probably a common issue for people migrating from traditional LaTeX setups to modern Org mode workflows.

Now I can seamlessly export my Org files to both HTML (for my website) and PDF (for offline reading or sharing). The conditional export settings ensure my website exports stay clean while my PDF exports get all the necessary LaTeX infrastructure.

If you're setting up something similar, I hope this walkthrough saves you some debugging time. The combination of Org mode's flexibility and LaTeX's typesetting power is genuinely fantastic once you get past the initial configuration hurdles.

* References
- [[https://wiki.archlinux.org/title/TeX_Live][TeX Live on Arch Wiki]]
- [[https://orgmode.org/manual/LaTeX-Export.html][Org Mode Manual: LaTeX Export]]
- [[https://www.ctan.org/pkg/fontspec][fontspec package documentation]]
- [[https://www.ctan.org/pkg/ulem][ulem package documentation]]
- [[https://tug.org/xetex/][XeTeX project page]]
